<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!-- BootStrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
    integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <!-- FontAwesome -->
    <script src="https://kit.fontawesome.com/eeaaa00cac.js"></script>
    <!-- CSS -->
    <link rel="stylesheet" href="css/style.css">
    <title>Survey</title>
</head>
<!-- Hidden modal -->
<div class="modal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title">Best Match</h5>
            <button type="button" class="close modalClose" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
        </div>
        <div class="modal-footer">
            <button type="button" class="modalClose btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
        </div>
    </div>
</div>
<!-- end modal -->
<body>
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <div class="text-right">
                    <p class="display-4">Survey Questions</h1>
                    <img src="images/phone.png">
                </div>
                <h3>About You</h3>
                <form>
                    <div class="form-group">
                        <label for="name">Name</label>
                        <input type="text" class="form-control" id="name" placeholder="John Smith" required>
                        <label for="picURL">URL for Photo</label>
                        <input type="text" class="form-control" id="picURL" placeholder="https://i.imgur.com/mqY2gla.png" required>
                        <br>
                        <hr>
                        <p class="lead"><i>Answer the questions below, where 1 represents agreeing the least and 5 represents agreeing the most.</i></p>
                        <h5>Question 1</h5>
                        <p>The best first date is going to the movies.</p>                        
                        <div class="input-group-prepend" id="q1">
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="1">
                                <p class="dialNum">1</p>
                                <p class="padText">&nbsp;</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="2">
                                <p class="dialNum">2</p>
                                <p class="padText">ABC</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="3">
                                <p class="dialNum">3</p>
                                <p class="padText">DEF</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="4">
                                <p class="dialNum">4</p>
                                <p class="padText">GHI</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="5">
                                <p class="dialNum">5</p>
                                <p class="padText">MNO</p>
                            </button>    
                        </div>                        
                        <h5>Question 2</h5>
                        <p>My favorite thing to wear is anything yellow.</p>
                        <div class="input-group-prepend" id="q2">
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="1">
                                <p class="dialNum">1</p>
                                <p class="padText">&nbsp;</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="2">
                                <p class="dialNum">2</p>
                                <p class="padText">ABC</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="3">
                                <p class="dialNum">3</p>
                                <p class="padText">DEF</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="4">
                                <p class="dialNum">4</p>
                                <p class="padText">GHI</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="5">
                                <p class="dialNum">5</p>
                                <p class="padText">MNO</p>
                            </button>    
                        </div>       
                        <h5>Question 3</h5>
                        <p>Skateboarding is my passion.</p>
                        <div class="input-group-prepend" id="q3">
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="1">
                                <p class="dialNum">1</p>
                                <p class="padText">&nbsp;</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="2">
                                <p class="dialNum">2</p>
                                <p class="padText">ABC</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="3">
                                <p class="dialNum">3</p>
                                <p class="padText">DEF</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="4">
                                <p class="dialNum">4</p>
                                <p class="padText">GHI</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="5">
                                <p class="dialNum">5</p>
                                <p class="padText">MNO</p>
                            </button>    
                        </div>       
                        <h5>Question 4</h5>
                        <p>You will never see my hair because I'm always wearing a hat.</p>
                        <div class="input-group-prepend" id="q4">
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="1">
                                <p class="dialNum">1</p>
                                <p class="padText">&nbsp;</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="2">
                                <p class="dialNum">2</p>
                                <p class="padText">ABC</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="3">
                                <p class="dialNum">3</p>
                                <p class="padText">DEF</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="4">
                                <p class="dialNum">4</p>
                                <p class="padText">GHI</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="5">
                                <p class="dialNum">5</p>
                                <p class="padText">MNO</p>
                            </button>    
                        </div>       
                        <h5>Question 5</h5>
                        <p>I love hot dogs.</p>
                        <div class="input-group-prepend" id="q5">
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="1">
                                <p class="dialNum">1</p>
                                <p class="padText">&nbsp;</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="2">
                                <p class="dialNum">2</p>
                                <p class="padText">ABC</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="3">
                                <p class="dialNum">3</p>
                                <p class="padText">DEF</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="4">
                                <p class="dialNum">4</p>
                                <p class="padText">GHI</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="5">
                                <p class="dialNum">5</p>
                                <p class="padText">MNO</p>
                            </button>    
                        </div>       
                        <h5>Question 6</h5>
                        <p>I'm in athleisure wear 24/7.</p>
                        <div class="input-group-prepend" id="q6">
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="1">
                                <p class="dialNum">1</p>
                                <p class="padText">&nbsp;</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="2">
                                <p class="dialNum">2</p>
                                <p class="padText">ABC</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="3">
                                <p class="dialNum">3</p>
                                <p class="padText">DEF</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="4">
                                <p class="dialNum">4</p>
                                <p class="padText">GHI</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="5">
                                <p class="dialNum">5</p>
                                <p class="padText">MNO</p>
                            </button>    
                        </div>       
                        <h5>Question 7</h5>
                        <p>Baseball is the greatest American pastime.</p>
                        <div class="input-group-prepend" id="q7">
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="1">
                                <p class="dialNum">1</p>
                                <p class="padText">&nbsp;</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="2">
                                <p class="dialNum">2</p>
                                <p class="padText">ABC</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="3">
                                <p class="dialNum">3</p>
                                <p class="padText">DEF</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="4">
                                <p class="dialNum">4</p>
                                <p class="padText">GHI</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="5">
                                <p class="dialNum">5</p>
                                <p class="padText">MNO</p>
                            </button>    
                        </div>       
                        <h5>Question 8</h5>
                        <p>I look cool in whatever I wear.</p>
                        <div class="input-group-prepend" id="q8">
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="1">
                                <p class="dialNum">1</p>
                                <p class="padText">&nbsp;</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="2">
                                <p class="dialNum">2</p>
                                <p class="padText">ABC</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="3">
                                <p class="dialNum">3</p>
                                <p class="padText">DEF</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="4">
                                <p class="dialNum">4</p>
                                <p class="padText">GHI</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="5">
                                <p class="dialNum">5</p>
                                <p class="padText">MNO</p>
                            </button>    
                        </div>
                        <h5>Question 9</h5>
                        <p>The mall is the best place to go shopping.</p>
                        <div class="input-group-prepend" id="q9">
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="1">
                                <p class="dialNum">1</p>
                                <p class="padText">&nbsp;</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="2">
                                <p class="dialNum">2</p>
                                <p class="padText">ABC</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="3">
                                <p class="dialNum">3</p>
                                <p class="padText">DEF</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="4">
                                <p class="dialNum">4</p>
                                <p class="padText">GHI</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="5">
                                <p class="dialNum">5</p>
                                <p class="padText">MNO</p>
                            </button>    
                        </div>
                        <h5>Question 10</h5>
                        <p>Ice cream is my favorite dessert.</p>
                        <div class="input-group-prepend" id="q10">
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="1">
                                <p class="dialNum">1</p>
                                <p class="padText">&nbsp;</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="2">
                                <p class="dialNum">2</p>
                                <p class="padText">ABC</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="3">
                                <p class="dialNum">3</p>
                                <p class="padText">DEF</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="4">
                                <p class="dialNum">4</p>
                                <p class="padText">GHI</p>
                            </button>
                            <button class="btn btn-outline-secondary phoneBtns" type="button" value="5">
                                <p class="dialNum">5</p>
                                <p class="padText">MNO</p>
                            </button>    
                        </div>
                    </div>
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                    <button type="button" class="btn btn-secondary sendBtns disabled"><i class="fas fa-asterisk"></i></button>
                    <button type="submit" class="btn btn-success sendBtns submit"><i class="fas fa-phone"></i></button>
                    <button type="button" class="btn btn-secondary sendBtns disabled"><i class="fas fa-hashtag"></i></button>
                </form>
            </div>
        </div>
    </div>
    <!-- Footer -->
    <div class="container">
        <div class="row">
            <div class="col-md-12 text-right">
                <hr>
                <p><a href="/api/friends">API Friends List</a> | <a href="https://github.com/bflatbader/FriendFinder">GitHub Repo</a></p>
            </div>
        </div>
    </div>
</body>
</html>

<!-- Custom JavaScript -->
<script type="text/javascript">
// VARIABLES
var answers = [];
var comaptibility = [];
var friendsAPI = "/api/friends";
var ans = {};

// Get values from selected answers in the survey and push to ans object
$(".btn-outline-secondary").on("click", function(event) {
    // Toggle which buttons are selected
    $(this).addClass('selectedPhoneBtn').siblings().removeClass('selectedPhoneBtn');
    // Get the question ID
    id = $(this).closest("div").prop("id");
    
    // Add the question's answer to the ans object, this will also replace any previous answers
    switch (id) {
        case 'q1':
            ans['a1'] = $(this).val().trim();
            console.log(ans);
            break;
        case 'q2':
            ans['a2'] = $(this).val().trim();
            console.log(ans);
            break;
        case 'q3':
            ans['a3'] = $(this).val().trim();
            console.log(ans);
            break;
        case 'q4':
            ans['a4'] = $(this).val().trim();
            console.log(ans);
            break;
        case 'q5':
            ans['a5'] = $(this).val().trim();
            console.log(ans);
            break;
        case 'q6':
            ans['a6'] = $(this).val().trim();
            console.log(ans);
            break;
        case 'q7':
            ans['a7'] = $(this).val().trim();
            console.log(ans);
            break;
        case 'q8':
            ans['a8'] = $(this).val().trim();
            console.log(ans);
            break;
        case 'q9':
            ans['a9'] = $(this).val().trim();
            console.log(ans);
            break;
        case 'q10':
            ans['a10'] = $(this).val().trim();
            console.log(ans);
            break;
    };
});

// Close modal dialog box handling
$(".modalClose").on("click", function(event) {
    $('.modal').hide();
});

// When user clicks to submit the survey
$(".submit").on("click", function(event) {
    event.preventDefault();

    // AJAX request
    $.ajax({
        url: friendsAPI,
        method: "GET"
    })
    // After data comes back from the request
    .then(function (friendsResults) {
        // Get user data
        var userName = $("#name").val().trim();
        var pic = $("#picURL").val().trim();

        // Convert answers to array
        for (i in ans) {
            answers.push(ans[i]);
        }

        // Create new friend object
        newFriend = {"name": userName, "photo": pic, "scores": answers};

        // Post new friend data
        $.post("/api/friends", newFriend)
        .then(function(data) {
            console.log("Adding friends", data);
        });

        // Compare friend answers to users answers
        for (i in friendsResults) {
            friendName = friendsResults[i].name;
            friendAnswers = friendsResults[i].scores;
            friendPic = friendsResults[i].photo;
            differences = 0;
            for(x in friendAnswers) {
                differences += Math.abs(friendAnswers[x] - answers[x]);
            }
            friend = {name: friendName, pic: friendPic, totalDifferences: differences};
            comaptibility.push(friend);
        }

        // Find the friend with the least difference
        var lowest = Number.POSITIVE_INFINITY;
        for (y in comaptibility) {
            if (comaptibility[y].totalDifferences < lowest) {
                lowest = comaptibility[y].totalDifferences;
                bestFriend = comaptibility[y];
                console.log("Current Best Friend: " + bestFriend.name);
            }
        }
        
        // Tell me the best friend match
        console.log(comaptibility);
        console.log("Absolute Best Friend: " + bestFriend.name);

        percentMatch = (100 - ((bestFriend.totalDifferences / 40) * 100));

        friendInfo = `
        <h3>${bestFriend.name}</h3>
        <p class="lead"><i>They'll really like you!</i></p>
        <img src="${bestFriend.pic}">
        <h5>${percentMatch}% Match</h5>
        `

        $( ".modal-body" ).html(friendInfo);
        $('.modal').show();
    });
});
</script>