<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <!-- BootStrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"
    integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script> -->
    <!-- CSS -->
    <link rel="stylesheet" href="css/style.css">
    <title>Survey</title>
</head>
<!-- Hidden modal -->
<div class="modal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-lg" role="document">
        <div class="modal-content">
        <div class="modal-header">
            <h5 class="modal-title">Best Match</h5>
            <button type="button" class="close modalClose" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
            </button>
        </div>
        <div class="modal-body">
        </div>
        <div class="modal-footer">
            <button type="button" class="modalClose btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
        </div>
    </div>
</div>
<!-- end modal -->
<body>
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <p class="display-4">Survey Questions</h1>
                <hr>
                <h3>About You</h3>
                <form>
                    <div class="form-group">
                        <label for="name">Name</label>
                        <input type="text" class="form-control" id="name" placeholder="John Smith" required>
                        <label for="picURL">URL for Photo</label>
                        <input type="text" class="form-control" id="picURL" placeholder="https://i.imgur.com/mqY2gla.png" required>
                        <hr>
                        <h5>Question 1</h5>
                        <p>The best first date is going to the movies.</p>
                        <select class="form-control" id="q1" required>
                            <option value="" disabled selected>Select an option</option>
                            <option value="1">1 (Strongly Disagree)</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5 (Strongly Agree)</option>
                        </select>
                        <h5>Question 2</h5>
                        <p>My favorite thing to wear is anything yellow.</p>
                        <select class="form-control" id="q2" required>
                            <option value="" disabled selected>Select an option</option>
                            <option value="1">1 (Strongly Disagree)</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5 (Strongly Agree)</option>
                        </select>
                        <h5>Question 3</h5>
                        <p>Skateboarding is my passion.</p>
                        <select class="form-control" id="q3" required>
                            <option value="" disabled selected>Select an option</option>
                            <option value="1">1 (Strongly Disagree)</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5 (Strongly Agree)</option>
                        </select>
                        <h5>Question 4</h5>
                        <p>You will never see my hair because I'm always wearing a hat.</p>
                        <select class="form-control" id="q4" required>
                            <option value="" disabled selected>Select an option</option>
                            <option value="1">1 (Strongly Disagree)</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5 (Strongly Agree)</option>
                        </select>
                        <h5>Question 5</h5>
                        <p>I love hot dogs.</p>
                        <select class="form-control" id="q5" required>
                            <option value="" disabled selected>Select an option</option>
                            <option value="1">1 (Strongly Disagree)</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5 (Strongly Agree)</option>
                        </select>
                        <h5>Question 6</h5>
                        <p>I'm in athleisure wear 24/7.</p>
                        <select class="form-control" id="q6" required>
                            <option value="" disabled selected>Select an option</option>
                            <option value="1">1 (Strongly Disagree)</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5 (Strongly Agree)</option>
                        </select>
                        <h5>Question 7</h5>
                        <p>Baseball is the greatest American pastime.</p>
                        <select class="form-control" id="q7" required>
                            <option value="" disabled selected>Select an option</option>
                            <option value="1">1 (Strongly Disagree)</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5 (Strongly Agree)</option>
                        </select>
                        <h5>Question 8</h5>
                        <p>I look cool in whatever I wear.</p>
                        <select class="form-control" id="q8" required>
                            <option value="" disabled selected>Select an option</option>
                            <option value="1">1 (Strongly Disagree)</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5 (Strongly Agree)</option>
                        </select>
                        <h5>Question 9</h5>
                        <p>The mall is the best place to go shopping.</p>
                        <select class="form-control" id="q9" required>
                            <option value="" disabled selected>Select an option</option>
                            <option value="1">1 (Strongly Disagree)</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5 (Strongly Agree)</option>
                        </select>
                        <h5>Question 10</h5>
                        <p>Ice cream is my favorite dessert.</p>
                        <select class="form-control" id="q10" required>
                            <option value="" disabled selected>Select an option</option>
                            <option value="1">1 (Strongly Disagree)</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5 (Strongly Agree)</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-purp submit">Submit</button>
                </form>
            </div>
        </div>
    </div>
    <!-- Footer -->
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <hr>
                <p><a href="/api/friends">API Friends List</a> | <a href="https://github.com/bflatbader/FriendFinder">GitHub Repo</a></p>
            </div>
        </div>
    </div>
</body>
</html>

<!-- Custom JavaScript -->
<script type="text/javascript">
var answers = [];
var comaptibility = [];
var friendsAPI = "/api/friends";

$(".modalClose").on("click", function(event) {
    $('.modal').hide();
});


// When user clicks to submit the survey
$(".submit").on("click", function(event) {
    event.preventDefault();

    // AJAX request
    $.ajax({
        url: friendsAPI,
        method: "GET"
    })
    // After data comes back from the request
    .then(function (friendsResults) {
        // Get user data
        var userName = $("#name").val().trim();
        var pic = $("#picURL").val().trim();

        // Get all answers
        var ans = {
            a1: $("#q1").val().trim(),
            a2: $("#q2").val().trim(),
            a3: $("#q3").val().trim(),
            a4: $("#q4").val().trim(),
            a5: $("#q5").val().trim(),
            a6: $("#q6").val().trim(),
            a7: $("#q7").val().trim(),
            a8: $("#q8").val().trim(),
            a9: $("#q9").val().trim(),
            a10: $("#q10").val().trim()
        };

        // Convert answers to array
        for (i in ans) {
            answers.push(ans[i]);
        }

        // Create new friend object
        newFriend = {"name": userName, "photo": pic, "scores": answers};

        // Post new friend data
        $.post("/api/friends", newFriend)
        .then(function(data) {
            console.log("Adding friends", data);
        });

        // Compare friend answers to users answers
        for (i in friendsResults) {
            friendName = friendsResults[i].name;
            friendAnswers = friendsResults[i].scores;
            friendPic = friendsResults[i].photo;
            differences = 0;
            for(x in friendAnswers) {
                differences += Math.abs(friendAnswers[x] - answers[x]);
            }
            friend = {name: friendName, pic: friendPic, totalDifferences: differences};
            comaptibility.push(friend);
        }

        // Find the friend with the least difference
        var lowest = Number.POSITIVE_INFINITY;
        for (y in comaptibility) {
            if (comaptibility[y].totalDifferences < lowest) {
                lowest = comaptibility[y].totalDifferences;
                bestFriend = comaptibility[y];
                console.log("Current Best Friend: " + bestFriend.name);
            }
        }
        
        // Tell me the best friend match
        console.log(comaptibility);
        console.log("Absolute Best Friend: " + bestFriend.name);

        percentMatch = (100 - ((bestFriend.totalDifferences / 40) * 100));

        friendInfo = `
        <h3>${bestFriend.name}</h3>
        <p class="lead"><i>They'll really like you!</i></p>
        <img src="${bestFriend.pic}">
        <h5>${percentMatch}% Match</h5>
        `

        $( ".modal-body" ).html(friendInfo);
        $('.modal').show();
    });
});
</script>